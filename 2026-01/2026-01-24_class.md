## 「[数字タッチゲーム](https://github.com/QynToKey/MyNumbersGame)」のつづき

### `class`どうしのインスタンスの受け渡しについて

- **クラス**を越えて他のクラスの**インスタンスプロパティ**にアクセスする場合、その**インスタンス参照**を引数として受け渡す。

  1. `Boardクラス`の**コンストラクター**に、`Game`クラスの**インスタンス**を渡す。
    ```
    #1-1 Boardクラスのインスタンスにthisを渡す
      class Game {
      constructor() {
        this.board = new Board(this);
        …
      }
      …
      }
    ```
    ↓
    ```
    #1-2 Boardクラスのコンストラクターでthisを受け取る
      class Board {
        constructor(game) {
          …
        }
        …
      }
    ```

  2. `Boardクラス`経由で、`Panelクラス`に`Gameクラス`の**インスタンス**を渡す。
    ```
    #2-1 Panelクラスに渡せるようにプロパティにする
      class Board {
        constructor(game) {
          this.game = game;
          …
        }
        …
      }
    ```
    ↓
    ```
    #2-2 PanelクラスのインスタンスにGameクラスのthisを渡す
      class Board {
        constructor(game) {
          this.game = game;
          this.panels = [];
          for (let i = 0; i < 4; i++) {
            this.panels.push(new Panel(this.game));
          }
          …
        }
        …
      }
    ```

  3. `Panelクラス`の**コンストラクター**で、`Gameクラス`の**インスタンス**を受け取る。
    ```
    #3-1 Gameクラスのインスタンスを受け取る
      class Panel {
        constructor(game) {
          …
        }
        …
      }
    ```
    ↓
    ```
    #3-2 Panelクラス内で使えるようにプロパティ化
      class Panel {
        constructor(game) {
          this.game = game;
          …
        }
        …
      }
    ```

- **クラス**を越えて他のクラスの**インスタンスプロパティ**にアクセスする場合、**メソッド**を経由することが推奨されている。

  4. **インスタンス**を渡された`Panelクラス`側では、`Gameクラス`の**内部プロパティ**を直接操作せず、**メソッド**経由で利用する。
    ```
    #4-1 Gameクラスのプロパティへの操作をメソッド経由にする
      class Panel {
        …

        check() {
          if (this.game.getCurrentNum() === parseInt(this.el.textContent, 10)) { // ← `currentNum` をメソッド化
            this.el.classList.add('pressed');
            this.game.addCurrentNum(); // ← `currentNum++` をメソッド化

            if (this.game.getCurrentNum() === 4) { // ← `currentNum` をメソッド化
              clearTimeout(this.game.getTimeoutId()); // ← `timeoutId` をメソッド化
            }
          }
        }
      }
    ```
    ↓
    ```
    #4-2 Gameクラスの側で、外部からプロパティの操作ができるようにメソッドとして定義
      class Game {
        …

        // Panelクラスで利用できるようにプロパティメソッドを定義
        addCurrentNum() {
          this.currentNum++;
        }

        getCurrentNum() {
          return this.currentNum;
        }

        getTimeoutId () {
          return this.timeoutId;
        }
      }
    ```

### ゲームの難易度を変更できるようにするには...

1. 難易度を数値で渡す
  ```
  new Game(2);
  ```

2. `Gameクラス`の**コンストラクター**で、**引数**として受け取って、**プロパティメソッド**を定義する。
  ```
  class Game {
      constructor(level) { // 2-1 難易度の数値を受け取る
        this.level = level; // 2-2 プロパティにする
        this.board = new Board(this);
        …
      }

      …

      getLevel() {
        return this.level; // 2-3 他のクラスで利用できるようにプロパティメソッドを定義
      }
    }
    ```

3. `Gameクラス`で定義された**プロパティメソッド**を、それぞれのクラスで受け取る。
  ```
  // 実装例
    for (let i = 0; i < this.game.getLevel() ** 2; i++) {
      this.panels.push(new Panel(this.game));
    }
  ```

4. 難易度に応じてパネルの描画を自動生成する。
  ```
  #4-1 難易度に応じてパネルの描画を自動生成するメソッドを定義
    setUp() {
        const container = document.getElementById('container');
        const PANEL_WIDTH = 50;
        const BOARD_PADDING = 10;
        container.style.width = PANEL_WIDTH * this.level + BOARD_PADDING * 2 + 'px';
      }
  ```
  ↓
  ```
  #4-2 コンストラクター内でメソッドを呼び出す
    class Game {
    constructor(level) {
      …
      this.setUp();
    }
  ```
