## 「[Todo管理アプリ](https://github.com/QynToKey/MyTodoApp)」のつづき

### フォーム入力機能の実装

  - `form`が`submit`されるとデフォルトでページが遷移してしまうため、再読み込みしないようにする。
    ```
      document.querySelector('#add-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const input = document.querySelector('#add-form input');
        const todo = {
          title: input.value,
          isCompleted: false,
        };
        renderTodo(todo);
        title: input.value = '';
        title: input.focus();
      });
    ```

    - イベントオブジェクトを渡して`e.preventDefault();`とする。
    - `preventDefault();`: ブラウザに*既定のアクション*を通常どおりに行うべきではないことを伝えるインターフェイスのメソッド。

    #### 「規定のアクション」の代表例
    | イベント          | 対象要素                     | 既定のアクション                |
    | ------------- | ------------------------ | ----------------------- |
    | `click`       | `<a>`                    | `href` への遷移             |
    | `click`       | `<button type="submit">` | フォーム送信                  |
    | `submit`      | `<form>`                 | フォーム送信（HTTPリクエスト・ページ遷移） |
    | `keydown`     | `<input>`                | 文字が入力される                |
    | `contextmenu` | 任意                       | 右クリックメニュー表示             |


### ローカルストレージを導入

  #### `JSON.stringify()` と `JSON.parse()`

  - `localStorage.setItem('キー', '値')`で保存できるのは**文字列**のみなので、複雑なデータやオブジェクトの中身を管理するときは**`JSON形式`**に変換する。
    ```
    #動作確認用
      localStorage.setItem('todos', JSON.stringify(todos));
      console.log(JSON.parse(localStorage.getItem('todos')));
    ```

  - 保存内容の確認は「開発者ツール > アプリケーション > ストレージ > ローカルストレージ > `file://`」で。

  #### ローカルストレージの実装例
    ```
    let todos;

    # 初期状態をJSON形式で取得
    if (localStorage.getItem('todos') === null) {
      todos = [];
    } else {
      todos = JSON.parse(localStorage.getItem('todos'));
    }

    …

    # 描画のときにJSON形式から展開して保存
    document.querySelector('#add-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const input = document.querySelector('#add-form input');
      const todo = {
        id: Date.now(), // UNIXタイムスタンプをユニークIDとして付加
        title: input.value,
        isCompleted: false,
      };
      renderTodo(todo);
      todos.push(todo);
      localStorage.setItem('todos', JSON.stringify(todos));
      …
    });
    ```

### 削除機能の実装

  ```
    btn.addEventListener('click', () => {
      # if文でダイアログボックスを展開
      if (!confirm('削除してよろしいですか？')){
        return;
      }
      li.remove();
      # 「削除ボタンを押したアイテムではないアイテム」を配列に返す
      todos = todos.filter((item) => {
        return item.id !== todo.id;
      });
      localStorage.setItem('todos', JSON.stringify(todos));
  ```

### チェック機能の実装

  ```
  # チェックボックスのイベントは`change`
    input.addEventListener('change', () => {
      todos.forEach((item) => {
        # それがcheckしたIDのitemならば…
        if (item.id === todo.id) {
          # 真偽値を反転させる
          item.isCompleted = !item.isCompleted;
        }
      });
      # ローカルストレージを書き換える
      localStorage.setItem('todos', JSON.stringify(todos));
    });
  ```

### Purgeボタン（まとめて削除機能）の実装

  ```
  # ローカルストレージの更新をメソッドに（ここでは関数式）
  const saveTodos = () => {
    localStorage.setItem('todos', JSON.stringify(todos));
  }

  …

  document.querySelector('#purge').addEventListener('click', () => {
    if (!confirm('削除してよろしいですか？')){
      return;
    }
    todos = todos.filter((todo) => {
      # 「チェックされた項目以外」を抽出
      return todo.isCompleted === false;
    });
    # ローカルストレージを更新
    saveTodos();
    # li要素を一旦すべて削除してから再描画
    document.querySelectorAll('#todos li').forEach((li) => {
      li.remove();
    });
    renderTodos();
  });
  ```
